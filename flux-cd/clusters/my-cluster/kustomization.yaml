apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  # Namespaces MUST be created first
  - ../../namespaces

  # RBAC resources
  - ../../rbac/staging-rbac.yaml
  - ../../rbac/production-rbac.yaml

  # Infrastructure - Repositories (these can be created anytime)
  - ../../infrastructure/postgres/helmrepository.yaml
  - ../../infrastructure/redis/helmrepository.yaml

  # Infrastructure - Staging (depends on staging namespace)
  - ../../infrastructure/postgres/staging/helmrelease.yaml
  - ../../infrastructure/redis/staging/helmrelease.yaml

  # Infrastructure - Production (depends on production namespace)
  - ../../infrastructure/postgres/production/helmrelease.yaml
  - ../../infrastructure/redis/production/helmrelease.yaml

  # Super-Todo Chart
  - super-todo-helmchart.yaml

  # Applications - Staging (depends on staging namespace and infrastructure)
  - ../../apps/super-todo/staging/helmrelease.yaml

  # Applications - Production (depends on production namespace and infrastructure)
  - ../../apps/super-todo/production/helmrelease.yaml

commonAnnotations:
  deployment.type: full-stack
  fluxcd.io/reconcile: enabled
